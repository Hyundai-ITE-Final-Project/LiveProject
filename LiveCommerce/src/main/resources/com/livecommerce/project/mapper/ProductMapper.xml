<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- /**
 * @author 김나형
 * @since 2023.01.10
 * @version 1.0
 * 
 * <pre>
 * 수정일              	수정자                   수정내용

 * </pre>
 */ -->
<mapper namespace="com.livecommerce.project.mapper.ProductMapper">

	<!-- 전체상품리스트 -->
	<select id="getListWithPaging" resultType="com.livecommerce.project.vo.ProductVO" >
	  <![CDATA[
	          select pid, pname, price, img1
	          from (
	               select rownum rn, pid, pname, price, img1
	                from product
	                 where rownum <= #{pageNum} * #{amount}
	                 )
	         where rn > ( #{pageNum} - 1 ) * #{amount}
	   ]]>
	</select>
	
	<!-- 전체상품갯수 -->
	<select id="getTotalCount" resultType="int">
		select count(*)
		from product
	</select>
	
	<!-- 상품 상세조회 -->
	<select id="productGetDetail"
		resultType="com.livecommerce.project.vo.ProductVO">
		select *
		from product p
		where p.pid=#{pid}
	</select>
	
	<!-- 카테고리별 상품조회 -->
	<select id="getListWithCategory" resultType="com.livecommerce.project.vo.ProductVO">
		SELECT p.*
		FROM
		(select rownum rn, pid, pname, price, img1
		 from
		 	(select *
		 	 from product
			 where lcategory = #{lcategory}
				<if test="scategory !='' ">
					and scategory =#{scategory}
				</if>
			 )
		 ) p
			<![CDATA[
			WHERE p.rn > (#{param1.pageNum} -1) * #{param1.amount} and p.rn <= #{param1.pageNum} * #{param1.amount}
    		]]>
	</select>
	
	<!-- 카테고리별 상품 총 개수 -->
	<select id="getCategoryTotal" resultType="int">
		select count(*)
		from product
		where lcategory = #{lcategory}
			<if test="scategory !='' ">
				and scategory =#{scategory}
			</if>
	</select>
</mapper>